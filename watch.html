<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SATV+ Watch</title>

  <!-- CSS del player -->
  <link rel="stylesheet" href="https://akira.satvplus.com.ar/akira-player.css" />

  <style>
    html,
    body {
      margin: 0;
      background: #000;
      height: 100%;
    }

    body {
      overflow: hidden;
    }

    #akira-player-root {
      width: 100%;
      min-height: 100vh;
      background: #000;
    }

    .watch-error {
      color: #fff;
      font-family: system-ui, sans-serif;
      padding: 16px;
      margin: 16px;
      background: #111;
      border: 1px solid #333;
      border-radius: 12px;
      white-space: pre-wrap;
      line-height: 1.4;
    }
  </style>
</head>

<body data-asset-base="https://akira.satvplus.com.ar/assets">
  <div id="akira-player-root"></div>

  <!-- 1) Supabase global (porque supabaseClient.js usa window.supabase) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- 2) UMD del player -->
  <script src="https://akira.satvplus.com.ar/akira-player.umd.js"></script>

  <!-- 3) Bridge: watch.js llamará window.renderAkiraPlayer(props) -->
  <script>
    (function () {
      const rootEl = document.getElementById("akira-player-root");

      function fail(msg) {
        rootEl.innerHTML = '<div class="watch-error">' + msg + '</div>';
      }

      // Si el UMD no expone este global, lo mostramos claro
      if (!window.AkiraPlayer) {
        fail("No cargó AkiraPlayer UMD (window.AkiraPlayer undefined).");
        console.error("[watch.html] window.AkiraPlayer undefined");
        return;
      }

      window.renderAkiraPlayer = function renderAkiraPlayer(props) {
        const mergedProps = Object.assign(
          {
            assetBaseUrl: document.body?.dataset?.assetBase || "https://akira.satvplus.com.ar/assets"
          },
          props || {}
        );

        try {
          // 1) API del UMD (si existe)
          if (typeof window.AkiraPlayer.mount === "function") {
            window.AkiraPlayer.mount(rootEl, mergedProps);
            return;
          }

          if (typeof window.AkiraPlayer.render === "function") {
            window.AkiraPlayer.render(rootEl, mergedProps);
            return;
          }

          // 2) Fallback React/ReactDOM (si el UMD expone componentes)
          const ReactGlobal = window.React || window.AkiraPlayer.React;
          const ReactDOMGlobal = window.ReactDOM || window.AkiraPlayer.ReactDOM;
          const Component =
            window.AkiraPlayer.default ||
            window.AkiraPlayer.AkiraPlayer ||
            window.AkiraPlayer;

          if (ReactGlobal && ReactDOMGlobal && typeof Component === "function") {
            if (typeof ReactDOMGlobal.createRoot === "function") {
              if (!window.__akiraWatchRoot) {
                window.__akiraWatchRoot = ReactDOMGlobal.createRoot(rootEl);
              }
              window.__akiraWatchRoot.render(ReactGlobal.createElement(Component, mergedProps));
              return;
            }

            if (typeof ReactDOMGlobal.render === "function") {
              ReactDOMGlobal.render(ReactGlobal.createElement(Component, mergedProps), rootEl);
              return;
            }
          }

          fail("AkiraPlayer cargó pero no se pudo montar (sin mount/render ni ReactDOM compatible).");
          console.error("[watch.html] No se pudo montar AkiraPlayer", {
            akira: window.AkiraPlayer,
            keys: Object.keys(window.AkiraPlayer || {})
          });
        } catch (e) {
          fail("Error montando AkiraPlayer: " + (e?.message || e));
          console.error("[watch.html] renderAkiraPlayer error", e);
        }
      };
    })();
  </script>

  <!-- 4) Loader (lee query params + Supabase + arma props) -->
  <script type="module" src="./js/watch.js"></script>
</body>

</html>